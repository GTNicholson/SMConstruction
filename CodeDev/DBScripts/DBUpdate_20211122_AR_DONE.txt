
ALTER VIEW [dbo].[vwSalesOrderPhaseItemTrackingInfo]
as

select 
SOPI.SalesOrderPhaseItemID,
SOI.Description,
SOI.ItemNumber,
SOI.UnitPrice,
SOI.HouseTypeID,
ISNULL(SOI.StockItemCost,0) AS 'StockItemCost',
ISNULL(SOPIMRS.SOPItemMatReqCost,0) as 'SOPItemMatReqCost',
ISNULL(SOPIMRS.SOPItemPickMatReqCost,0) as 'SOPItemPickMatReqCost',
ISNULL(SOI.WoodCost,0) AS 'WoodCost',
ISNULL(SOI.ManpowerCost,0) AS 'ManpowerCost',
ISNULL(SOI.SubContractCost,0) AS 'SubContractCost',
ISNULL(SOI.TransportationCost,0) AS 'TransportationCost',
ISNULL(SOI.MaterialCost,0) AS 'MaterialCost',
ISNULL(SOPIPOIA.POIAOutsourcingSum,0) AS 'SOPIItemOutsourcingCost',
SOI.SalesOrderItemID,
SO.SalesOrderID,
SO.ProjectName,
SO.OrderNo,
SO.DateEntered,
so.FinishDate,
SO.OrderStatusENUM,
SOP.DateCommitted,
SOP.SalesOrderPhaseID,
CU.CompanyName,
SOPITSCOT.TotalCost ManPowerActualTotalCost
from 
SalesOrderPhaseItem SOPI
INNER JOIN SalesOrderItem SOI ON SOI.SalesOrderItemID=SOPI.SalesItemID
INNER JOIN SalesOrder SO ON SO.SalesOrderID = SOI.SalesOrderID
INNER JOIN SalesOrderPhase SOP ON SOP.SalesOrderID=SO.SalesOrderID
LEFT join vwSalesOrderPhaseItemMatReqSum SOPIMRS ON SOPIMRS.SalesOrderPhaseItemID=SOPI.SalesOrderPhaseItemID
left join vwPOIASOPIOutsourcingCostSUM SOPIPOIA ON SOPIPOIA.SalesorderPhaseItemID=SOPI.SalesOrderPhaseItemID
left JOIN Customer CU ON CU.CustomerID=SO.CustomerID
LEFT JOIN vwSalesOrderPhaseItemTimeSheetCostByOTSummary SOPITSCOT ON SOPITSCOT.SalesOrderPhaseItemID = SOPI.SalesOrderPhaseItemID

GO

alter table MaterialRequirement
alter column DateChange datetime
go
